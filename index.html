<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jurnal 7A Minimalis</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #F9FAFB;
            --bg-card: #FFFFFF;
            --primary: #1F2937;
            --accent: #10B981;
            --text-main: #111827;
            --text-muted: #6B7280;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; background: var(--bg-body); color: var(--text-main); padding-bottom: 80px; }

        /* --- HEADER --- */
        .header {
            background: white; padding: 15px 20px;
            border-bottom: 1px solid #E5E7EB;
            position: sticky; top: 0; z-index: 50;
        }
        .header h2 { margin: 0; font-size: 1.1em; color: var(--primary); }
        .header p { margin: 0; font-size: 0.8em; color: var(--text-muted); }

        /* --- DASHBOARD --- */
        .dashboard-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 15px;
        }
        .mini-stat {
            background: white; padding: 10px 5px; border-radius: 10px; text-align: center;
            border: 1px solid #E5E7EB;
        }
        .mini-val { display: block; font-weight: bold; font-size: 1.2em; color: var(--primary); }
        .mini-lbl { font-size: 0.65em; color: var(--text-muted); text-transform: uppercase; margin-top: 3px; }

        /* --- ABSENSI & INPUT --- */
        .section { display: none; padding: 15px; animation: fadeIn 0.2s; }
        .section.active { display: block; }
        
        .input-card { background: white; padding: 15px; border-radius: 12px; border: 1px solid #E5E7EB; margin-bottom: 15px; }
        label { display: block; font-size: 0.8em; font-weight: 600; margin-bottom: 5px; color: var(--text-muted); }
        select, input, textarea {
            width: 100%; padding: 10px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px; margin-bottom: 10px;
        }
        .btn-main {
            width: 100%; background: var(--primary); color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; margin-top: 5px;
        }

        /* --- LIST ABSENSI COMPACT --- */
        .absen-row {
            display: flex; justify-content: space-between; align-items: center; padding: 12px 0;
            border-bottom: 1px solid #F3F4F6;
        }
        .absen-name { font-size: 0.9em; font-weight: 500; width: 50%; }
        .absen-opts { display: flex; gap: 5px; }
        
        /* Radio Button Styling */
        input[type="radio"] { display: none; }
        .opt-lbl {
            width: 32px; height: 32px; border-radius: 6px; display: flex; align-items: center; justify-content: center;
            font-size: 0.8em; font-weight: bold; background: #F3F4F6; color: #9CA3AF; cursor: pointer;
        }
        input[value="S"]:checked + .opt-lbl { background: var(--info); color: white; }
        input[value="I"]:checked + .opt-lbl { background: var(--warning); color: white; }
        input[value="A"]:checked + .opt-lbl { background: var(--danger); color: white; }
        /* H hidden default */

        /* --- RIWAYAT MINIMALIS (ACCORDION) --- */
        .tab-switcher { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn {
            flex: 1; padding: 8px; background: #E5E7EB; border: none; border-radius: 8px; font-size: 0.85em; font-weight: 600; color: #6B7280;
        }
        .tab-btn.active { background: var(--primary); color: white; }

        .hist-list { list-style: none; padding: 0; margin: 0; background: white; border-radius: 12px; border: 1px solid #E5E7EB; overflow: hidden; }
        .hist-item { border-bottom: 1px solid #F3F4F6; }
        .hist-item:last-child { border-bottom: none; }
        
        /* Baris Utama (Selalu Muncul) */
        .hist-summary {
            padding: 12px 15px; display: flex; align-items: center; justify-content: space-between; cursor: pointer;
        }
        .hist-left { display: flex; align-items: center; gap: 10px; overflow: hidden; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .hist-info { display: flex; flex-direction: column; }
        .hist-name { font-size: 0.9em; font-weight: 600; color: var(--text-main); }
        .hist-date { font-size: 0.75em; color: var(--text-muted); }
        .hist-arrow { font-size: 0.8em; color: #9CA3AF; transition: 0.2s; }

        /* Bagian Detail (Tersembunyi) */
        .hist-details {
            display: none; padding: 0 15px 15px 33px; font-size: 0.85em; color: #4B5563;
        }
        .hist-item.open .hist-details { display: block; }
        .hist-item.open .hist-arrow { transform: rotate(180deg); }
        .btn-del {
            color: var(--danger); background: none; border: 1px solid var(--danger); padding: 4px 10px; border-radius: 4px; font-size: 0.8em; margin-top: 8px; float: right;
        }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #E5E7EB;
            display: flex; justify-content: space-around; padding: 10px 0; z-index: 100;
        }
        .nav-item { text-align: center; color: #9CA3AF; font-size: 0.7em; padding: 5px; width: 25%; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-icon { font-size: 1.4em; display: block; margin-bottom: 2px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <h2>Kelas 7A</h2>
        <p>Jurnal Guru & Rekap Absensi</p>
    </div>

    <div id="view-home" class="section active">
        <div class="dashboard-grid">
            <div class="mini-stat"><span class="mini-val" id="stat-s" style="color:var(--info)">0</span><span class="mini-lbl">Sakit</span></div>
            <div class="mini-stat"><span class="mini-val" id="stat-i" style="color:var(--warning)">0</span><span class="mini-lbl">Izin</span></div>
            <div class="mini-stat"><span class="mini-val" id="stat-a" style="color:var(--danger)">0</span><span class="mini-lbl">Alpha</span></div>
            <div class="mini-stat"><span class="mini-val" id="stat-k">0</span><span class="mini-lbl">Kasus</span></div>
        </div>
        <div class="input-card" style="margin-top:10px; text-align:center; padding:20px;">
            <span style="font-size:3em;">üìÖ</span>
            <h3 id="date-display" style="margin:5px 0 0 0;">...</h3>
            <p style="margin:0; font-size:0.8em; color:#666;">Hari ini</p>
        </div>
    </div>

    <div id="view-absen" class="section">
        <div class="input-card">
            <label>Tanggal Absen</label>
            <input type="date" id="absen-tgl">
        </div>
        
        <div class="input-card" style="padding-top:5px; padding-bottom:5px;">
            <div id="list-siswa-absen"></div>
        </div>

        <button class="btn-main" onclick="simpanAbsen()">Simpan Absensi</button>
        <p style="text-align:center; font-size:0.75em; color:#999; margin-top:10px;">*Siswa yang tidak dicentang otomatis HADIR</p>
    </div>

    <div id="view-kasus" class="section">
        <div class="input-card">
            <label>Nama Siswa</label>
            <select id="kasus-nama"><option value="">-- Pilih --</option></select>
            
            <label style="margin-top:10px;">Tanggal</label>
            <input type="date" id="kasus-tgl">
            
            <label style="margin-top:10px;">Kategori</label>
            <select id="kasus-kat">
                <option value="Ringan">üü¢ Ringan (Atribut/Terlambat)</option>
                <option value="Sedang">üü† Sedang (Bolos/Gaduh)</option>
                <option value="Berat">üî¥ Berat (Berkelahi/Bullying)</option>
            </select>
            
            <label style="margin-top:10px;">Keterangan</label>
            <textarea id="kasus-ket" rows="3" placeholder="Kronologi..."></textarea>
            
            <button class="btn-main" onclick="simpanKasus()">Simpan Kasus</button>
        </div>
    </div>

    <div id="view-riwayat" class="section">
        <div class="tab-switcher">
            <button class="tab-btn active" onclick="setHistMode('kasus', this)">Kasus</button>
            <button class="tab-btn" onclick="setHistMode('absen', this)">Absensi</button>
        </div>

        <ul id="hist-list" class="hist-list">
            </ul>
        
        <div style="text-align:right; margin-top:10px;">
             <button onclick="downloadCSV()" style="background:none; border:none; color:var(--accent); font-size:0.8em; font-weight:bold;">‚¨á Download Excel</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="nav('home', this)"><span class="nav-icon">üìä</span>Home</div>
        <div class="nav-item" onclick="nav('absen', this)"><span class="nav-icon">üìù</span>Absen</div>
        <div class="nav-item" onclick="nav('kasus', this)"><span class="nav-icon">‚ö†Ô∏è</span>Kasus</div>
        <div class="nav-item" onclick="nav('riwayat', this)"><span class="nav-icon">üìã</span>Riwayat</div>
    </div>

<script>
    // --- DATA SISWA ---
    const siswaList = [
        "Abbas Al Hilaly", "Akcmad Al Fachri", "Al Fath Rizqie Ramadhan", 
        "Alvino Nazulia Pratama", "Arrahman Zahir Ramadhan", "Azka Tsabitah Akmal", 
        "Azka Zaidan Abdu Ghani", "Daffa Chandra Putra", "Farhan Azmirrohman", 
        "Fauzan Indra Tama", "Fitrah Satriaji Wahyudi", "Ikhsanul Aziz", 
        "Ilham Daffa Syaputra", "Muhamad Ibnu Galih Saifani", "Muhamad Ilham Dwi Saputra", 
        "Muhammad Altaf Naufal", "Muhammad Azka Mubarak", "Muhammad Firdaus", 
        "Muhammad Ilram Nurfikriy", "Muhammad Restu Azriel Setiawan", "Muhammad Reyvan Bachri Putra", 
        "Muhammad Rifqy", "Muhammad Widad Fhasando", "Muhammad Zidan Sangsaka Ramadhani", 
        "Rakha Hanif Arryyan", "Revan Maulana Yusuf", "Wizra Rais Adlan", 
        "Yusuf Nur Suriya Hadi", "Zaidan Alfathizi Prasetya", "M. Harun Arrosyid"
    ];

    let histMode = 'kasus';

    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('absen-tgl').value = today;
        document.getElementById('kasus-tgl').value = today;
        
        // Date display
        const opts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('date-display').innerText = new Date().toLocaleDateString('id-ID', opts);

        initLists();
        loadStats();
        renderHistory();
    });

    function initLists() {
        // Dropdown Kasus
        const sel = document.getElementById('kasus-nama');
        siswaList.forEach(s => sel.innerHTML += `<option value="${s}">${s}</option>`);

        // List Absen
        const div = document.getElementById('list-siswa-absen');
        siswaList.forEach((s, i) => {
            div.innerHTML += `
            <div class="absen-row">
                <span class="absen-name">${i+1}. ${s}</span>
                <div class="absen-opts">
                    <input type="radio" name="abs_${i}" value="H" checked id="h_${i}">
                    <label>
                        <input type="radio" name="abs_${i}" value="S">
                        <span class="opt-lbl">S</span>
                    </label>
                    <label>
                        <input type="radio" name="abs_${i}" value="I">
                        <span class="opt-lbl">I</span>
                    </label>
                    <label>
                        <input type="radio" name="abs_${i}" value="A">
                        <span class="opt-lbl">A</span>
                    </label>
                    <div onclick="document.getElementById('h_${i}').checked=true" style="display:flex; align-items:center; padding:0 5px; color:#ccc;">‚Ü∫</div>
                </div>
            </div>`;
        });
    }

    // --- NAVIGATION ---
    window.nav = function(id, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('view-'+id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        if(id === 'home') loadStats();
        if(id === 'riwayat') renderHistory();
    }

    // --- LOGIC ---
    window.simpanAbsen = function() {
        const tgl = document.getElementById('absen-tgl').value;
        let db = JSON.parse(localStorage.getItem('db_absen')) || [];
        let count = 0;

        siswaList.forEach((nama, i) => {
            const val = document.querySelector(`input[name="abs_${i}"]:checked`).value;
            if(val !== 'H') {
                db.push({ id: Date.now()+i, date: tgl, name: nama, type: val });
                count++;
            }
        });
        
        localStorage.setItem('db_absen', JSON.stringify(db));
        alert(count + " siswa disimpan (S/I/A).");
        document.querySelectorAll('input[value="H"]').forEach(x => x.checked = true);
    }

    window.simpanKasus = function() {
        const n = document.getElementById('kasus-nama').value;
        const d = document.getElementById('kasus-tgl').value;
        const k = document.getElementById('kasus-kat').value;
        const ket = document.getElementById('kasus-ket').value;
        
        if(!n || !ket) return alert("Isi data lengkap!");
        
        let db = JSON.parse(localStorage.getItem('db_kasus')) || [];
        db.push({ id: Date.now(), date: d, name: n, cat: k, desc: ket });
        localStorage.setItem('db_kasus', JSON.stringify(db));
        
        alert("Kasus tersimpan.");
        document.getElementById('kasus-ket').value = '';
    }

    function loadStats() {
        const abs = JSON.parse(localStorage.getItem('db_absen')) || [];
        const kas = JSON.parse(localStorage.getItem('db_kasus')) || [];
        
        document.getElementById('stat-s').innerText = abs.filter(x=>x.type==='S').length;
        document.getElementById('stat-i').innerText = abs.filter(x=>x.type==='I').length;
        document.getElementById('stat-a').innerText = abs.filter(x=>x.type==='A').length;
        document.getElementById('stat-k').innerText = kas.length;
    }

    // --- RIWAYAT (ACCORDION) ---
    window.setHistMode = function(m, el) {
        histMode = m;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        renderHistory();
    }

    function renderHistory() {
        const ul = document.getElementById('hist-list');
        ul.innerHTML = '';
        
        let data = [];
        if(histMode === 'kasus') {
            data = JSON.parse(localStorage.getItem('db_kasus')) || [];
        } else {
            data = JSON.parse(localStorage.getItem('db_absen')) || [];
        }
        
        // Sort descending date
        data.sort((a,b) => new Date(b.date) - new Date(a.date));

        if(data.length === 0) {
            ul.innerHTML = '<li style="padding:20px; text-align:center; color:#ccc;">Belum ada data.</li>';
            return;
        }

        data.forEach(item => {
            let color = '#ccc';
            let label = '';
            let detailText = '';

            if(histMode === 'kasus') {
                if(item.cat === 'Ringan') color = '#10B981';
                else if(item.cat === 'Sedang') color = '#F59E0B';
                else color = '#EF4444';
                label = item.cat;
                detailText = item.desc;
            } else {
                if(item.type === 'S') { color = '#3B82F6'; label='Sakit'; }
                else if(item.type === 'I') { color = '#F59E0B'; label='Izin'; }
                else { color = '#EF4444'; label='Alpha'; }
                detailText = "Tidak masuk sekolah (Absensi)";
            }

            // Format Tanggal: 12 Feb
            const d = new Date(item.date);
            const dateStr = d.getDate() + ' ' + d.toLocaleString('id-ID', { month: 'short' });

            const li = document.createElement('li');
            li.className = 'hist-item';
            li.innerHTML = `
                <div class="hist-summary" onclick="toggleItem(this)">
                    <div class="hist-left">
                        <div class="status-dot" style="background:${color}"></div>
                        <div class="hist-info">
                            <span class="hist-name">${item.name}</span>
                            <span class="hist-date">${dateStr} ‚Ä¢ ${label}</span>
                        </div>
                    </div>
                    <div class="hist-arrow">‚ñº</div>
                </div>
                <div class="hist-details">
                    <p style="margin:0;">${detailText}</p>
                    <button class="btn-del" onclick="hapus(${item.id})">Hapus</button>
                    <div style="clear:both;"></div>
                </div>
            `;
            ul.appendChild(li);
        });
    }

    window.toggleItem = function(el) {
        el.parentElement.classList.toggle('open');
    }

    window.hapus = function(id) {
        if(!confirm("Hapus data ini?")) return;
        const key = histMode === 'kasus' ? 'db_kasus' : 'db_absen';
        let db = JSON.parse(localStorage.getItem(key)) || [];
        db = db.filter(x => x.id !== id);
        localStorage.setItem(key, JSON.stringify(db));
        renderHistory();
        loadStats();
    }

    window.downloadCSV = function() {
        const abs = JSON.parse(localStorage.getItem('db_absen')) || [];
        const kas = JSON.parse(localStorage.getItem('db_kasus')) || [];
        let csv = "TANGGAL,NAMA,TIPE,KETERANGAN\n";
        
        abs.forEach(x => csv += `${x.date},${x.name},${x.type},Absensi\n`);
        kas.forEach(x => csv += `${x.date},${x.name},${x.cat},"${x.desc}"\n`);
        
        const link = document.createElement("a");
        link.href = "data:text/csv;charset=utf-8," + encodeURI(csv);
        link.download = "Rekap_7A.csv";
        link.click();
    }
</script>
</body>
</html>
